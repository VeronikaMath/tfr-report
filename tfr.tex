\documentclass{article}  % this line must be in main document!! otherwise compiler gets confused
\input{preamble.tex}
\addbibresource{bibliography.bib}

\title{TFR Notes}
\author{Veronika Chronholm}
\date{\today}

\begin{document}

\setcounter{secnumdepth}{2}
\pagestyle{plain} % stile pagina (header, numerazioni)

% \centerline {\includegraphics[width=2cm]{logo.jpg}}
\begin{center}
    \large{EPSRC Centre for Doctoral Training in Statistical Applied Mathematics (SAMBa)} \\
	\line(1,0){450}\\ 
	\vspace{3.5cm} 
	{ \huge \textbf{Numerical Methods for Radiation Transport and Radiotherapy Treatment Planning} \\}
	%\vspace{0.1cm}
	%\line(1,0){450} \\
    \vspace{1.5cm} 
    \Large{Thesis Formulation Report} \\
    \vspace*{9cm}
    Veronika Chronholm
\end{center}

\thispagestyle{empty}

% \vspace*{5cm}
% {\hspace*{6cm} \large{{\begin{tabular}{ll}
% 			Written by Veronika Chronholm \\
%             \end{tabular}
% 	}}
% }
\newpage
\tableofcontents
\setcounter{page}{1}

\newpage

\section{Notes/To Do}
Things to write:
\begin{itemize}
    \item Background: introduce application to radiotherapy treatment planning and equations describing radiation transport. Introduce the simplified model (like reading course model) that we will focus on here. Maybe also full Boltzman equation?
    \item Explain how the choice of norm for the minimisation problem can lead to nonlinear PDEs - this motivates use of the full FBSDE framework (because we get nonlinear source terms)
    \item Explain why the full coupled system can't be fit into the FBSDE framework - the forward/primal equation is not of the form in the FBSDE system (even with constant coefficients, because of time reversal?)
    \item Details of how $z$ gets its BCs and TC from those we have for $u$
    \item Convergence of approximation (twofold x 2): Does the iterative scheme converge when soln's to the sequence of PDEs are exact? I.e. $u^{(k)} \rightarrow u^{(*)}$? And is $u^{(*)}$ the right thing? Furthermore, does the iterative scheme converge (and to the right thing) when the soln's to the sequence of PDEs are approximated numerical sol'ns?
    \item Results of numerical experiments
    \item Future extensions of this model/framework: Model for radiation in multiple spatial dimensions (now just 1D), better/more accurate discretisation schemes e.g. SSP, MLMC, higher order in general?
    \item another future work thing: figure out how to parallelize the MC code?
    \item Motivation for the SSP methods for FBSDE: iterating through numerically solving each PDE in sequence, we want to make sure error is not propagated / does not grow? (Also motivation for FBSDE framework is to deal with the nonlinearity that arises when a different norm is chosen for the optimisation problem)
    \item Write about how BCs on the dual ($z$) are implemented in the Monte Carlo simulations + FC for boundary value problems (integration bound = stopping time, i.e. random!)
\end{itemize}

NB: Need more references: 

\begin{itemize}
    \item Ref for the PDE constrained optimisation problem (and the iterative scheme for $(u^{(k)},z^{(k)})$) needed
    \item Reuse refs from reading course report 
    \item Some ref for physics-y bits? Or medical bits?
    \item We have a few refs for Monte Carlo stuff e.g. Gobet, Oksendal, Klebaner
    \item Also the SSP FBSDE paper (already in refs here)
\end{itemize}

\input{1_introduction.tex}
\input{2_background.tex}
\input{3_theory.tex}
\input{4_numerical_methods.tex}
\input{5_results.tex}
\input{6_future_work.tex}
\input{7_conclusions.tex}

\section{Spare Theory}

% - PDE Constrained optimisation problem 

% - Forward + Backward PDEs

% - Initial/terminal conditions, boundary conditions, and source terms (figure out equivalent formulations?)

% \vspace{5mm}
% - Forward + Backward SDEs

% - Connections between FBSDEs and the PDEs (eg distribution of process given by forward SDE is described by sol to Fokker-Planck/Kolmogorov forward eqn)

% - Feynman-Kac formulae (of various kinds)

% - Solving Fokker-Planck using MC + Feynman-Kac (as in reading course)

% - Simplest scheme for Forward-Backward SDEs

% - New (\cite{fang2023strong}) SSP scheme for FBSDEs

% - Specifically what schemes and equations look like for the reading course model

% - Similarities/Differences between the "first" (linear?) kind of Feynman-Kac formula, and the FBSDE *nonlinear* Feynman-Kac formulae?

% - CONSISTENT NOTATION --- there is something weird with functions $f$ and $g$ at the moment, for example\dots

\subsection{FBSDEs and systems of PDEs}

It is also possible to write down a more general version of \autoref{eq:fbsde}, where the process $Y_t$ which solves the backward SDE is allowed to be $K$-dimensional. This process can then be used to write down a probabilistic representation of the solution to a system of $K$ coupled PDEs (each with a terminal condition) of the type written down in \autoref{eq:nonlinear-pde}. For simplicity, here we consider the case where the source term $g$ does not depend on the gradient of $u$. Specifically, we then seek a probabilistic representation of $u = (u^{[1]},...,u^{[K]})$, where 
%
\begin{align} 
    \label{eq:pde-system}
\begin{cases}
    &\partial_t u^{[k]}(t,x) + \mathcal{L}^{[k]} u^{[k]}(t,x) + g^{[k]}(t,x,u(t,x)) = 0\\
    &u^{[k]}(T,x) = f^{[k]}(x)
\end{cases}
\end{align}
%
for $k=1,2,...,K$, and $g=(g^{[1]},...,g^{[K]})$, $f=(f^{[1]},...,f^{[K]})$. We note that in general each component of $g$ depends on the whole of $u$, and not just a particular component $u^{[k]}$.

Here, as before, $\mathcal{L}^{[k]}$ denotes the generator of a diffusion process, such as that described in the forward SDE of \autoref{eq:fbsde}. If the operator $\mathcal{L}^{[k]}$ is the same for each $k$, it is enough to consider one diffusion process $X_t$. However, if $\mathcal{L}^{[k]}$ is different for each $k$, we need $K$ different diffusion processes $(X_t^{[1]},...,X_t^{[K]})$, with corresponding generators $(\mathcal{L}^{[1]},...,\mathcal{L}^{[K]})$. In general, each process $X_t^{[k]}$ is $d$-dimensional, i.e. of the same dimension as the variable $x$ in the PDE in \autoref{eq:pde-system}. 

For simplicity, here we consider the case where the $X_t^{[k]}$ are one dimensional, and have constant coefficients, but the below argument is easily generalised to the $d$-dimensional case with nonconstant coefficients. We then have
%
\begin{align} 
    X_t^{[k]} = x + \int_{0}^{t} b_k ds + \int_{0}^{t}\sigma_k dW_s^{[k]}
\end{align}
%
each with corresponding generator
%
\begin{align} 
    \mathcal{L}^{[k]} = \frac{1}{2} \sigma_k^2 \partial_x^2 + b_k \partial_x.
\end{align}
%

We now claim that the processes $Y_t = (Y_t^{[1]},...,Y_t^{[K]})$ and $Z_t=(Z_t^{[1]},...,Z_t^{[K]})$ defined by 
%
\begin{align}
    \label{eq:y-def}
    Y_t^{[k]} &= u^{[k]}(t,X_t^{[k]})\\
    Z_t^{[k]} &= \sigma_k \partial_x u^{[k]}(t,X_t^{[k]})
\end{align}
%
obey the backward SDE
%
\begin{align} 
    \label{eq:component-bsde}
    Y_t^{[k]} = f^{[k]}(X_T^{[k]}) + \int_t^T g^{[k]}\big( s, X_s^{[k]},u(s,X_s) \big)ds - \int_t^T Z_s^{[k]}dW_s^{[k]},
\end{align}
%
where $u(s,X_s) = \big( u^{[1]}(s,X_s^{[1]}),..., u^{[K]}(s,X_s^{[K]})\big)$.

We show this holds by (componentwise) applying It√¥'s formula
%
\begin{align} 
    v(s,X_s) = v(s_0,X_{s_0}) + \int_{s_0}^{s} [\partial_t + \mathcal{L}] v(r,X_r)dr + \int_{s_0}^{s} \partial_x v(r,X_r) \sigma(r,X_r)dW_r,
\end{align}
%
where $\mathcal{L}$ is the generator of the diffusion process given by
%
\begin{align} 
    X_s = X_{s_0} + \int_{s_0}^{s} b(r,X_r)ds + \int_{s_0}^{s}\sigma(r,X_r)dW_r,
\end{align}
%
to the process $Y_t=(Y_t^{[1]},...,Y_t^{[K]})$ defined by \autoref{eq:y-def}, with $s_0=t$ and $s=T$. By noting that $u^{[k]}(T,X_T^{[k]})=f^{[k]}(X_T^{[k]})$ the result follows.

To obtain a Feynman-Kac formula for $u(t,x)$ we take a conditional expectation of \autoref{eq:component-bsde}. What to condition on is slightly subtle. By considering that the equations for $u^{[k]}(t,x)$ for each $k$ must be equations of the same variable $x$, and are coupled through the function $g$, we can see that a sensible thing to condition on is $X_t^{[1]}=x,...,X_t^{[K]}=x$. In other words, we start each of the diffusions $X^{[k]}_s$ at the same point $x$ at time $t$.
We then get the Feynman-Kac formula
%
\begin{align} 
    u^{[k]}(t,x) = \mathbb{E}\bigg[ f^{[k]}(X_T^{[k],x,t}) + \int_{t}^{T} g^{[k]}\big( s, X_s^{[k],x,t}, u(s,X_s^{x,t}) \big)ds \bigg],
\end{align}
%
where $X_T^{[k],x,t}$ denotes the process $X_s^{[k]}$ started at $x$ at time $t$, and $X_s^{x,t}$ denotes the ($k$-dimensional) $(X_s^{[1]},...,X_s^{[K]})$ started at $(x,...,x)$ at time $t$.

Similarly to before, we can also write down a formula for $Y_t^{[k]}$ as 
%
\begin{align}
Y_t^{[k]} = \mathbb{E}\bigg[ f^{[k]}(X_T^{[k]}) + \int_{t}^{T} g^{[k]}\big( s,X_s^{[k]},Y_s\big)ds \Big\lvert X_t^{[1]},...,X_t^{[K]}\bigg],
\end{align}
%
by conditioning on the processes $(X_t^{[1]},...,X_t^{[K]})$, at time $t$, instead of on $(X_t^{[1]}=x,...,X_t^{[K]}=x)$.



% \bibliographystyle{plain}
% \bibliography{bibliography.bib}
\newpage
\nocite{*}
\printbibliography

\end{document}
